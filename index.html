<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì„¸ê³„ì§€ë„ êµ­ê°€ ë§íˆê¸° í€´ì¦ˆ (êµ­ê¸°+ê°•í™”íŒíŠ¸)</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif; }
    #app { height: 100%; display: grid; grid-template-rows: auto 1fr auto; }
    header, footer { padding: 10px 14px; }
    header { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .badge { background: #eee; border-radius: 10px; padding: 4px 10px; font-size: 12px; }
    #map { width: 100%; height: 100%; background:#f3f5f8; }
    .panel { display: grid; gap: 8px; padding: 10px 14px; background: #fafafa; border-top: 1px solid #eaeaea; }
    .question { font-weight: 700; }
    .choices { display: grid; gap: 8px; grid-template-columns: repeat(2,minmax(0,1fr)); }
    button.choice {
      padding: 10px; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; font-size: 15px; background: white;
    }
    button.choice:hover { border-color: #aaa; }
    .result { min-height: 24px; font-weight: 600; }
    .controls { display: flex; gap: 8px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .btn { padding: 8px 12px; border-radius: 10px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-weight: 600; }
    .btn.primary { background: #1a73e8; color: #fff; border-color: #1a73e8; }
    .progress { height: 8px; background: #eee; border-radius: 999px; overflow: hidden; }
    .bar { height: 100%; width: 0%; background: #1a73e8; transition: width .3s; }
    .tiny { font-size: 12px; color: #666; }
    @media (max-width: 640px) { .choices { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="badge">ğŸŒ ì„¸ê³„ì§€ë„ êµ­ê°€ ë§íˆê¸°</div>
      <div class="badge" id="scoreBadge">ì ìˆ˜ 0</div>
      <div class="badge" id="roundBadge">ë¬¸ì œ 0 / 10</div>
      <div class="badge" id="streakBadge">ì—°ì†ì •ë‹µ 0</div>
    </header>

    <div id="map"></div>

    <div class="panel">
      <div class="progress"><div class="bar" id="progressBar"></div></div>
      <div class="question" id="question">ì´ ë‚˜ë¼ê°€ ì–´ë””ì¼ê¹Œìš”?</div>
      <div class="choices" id="choices"></div>
      <div class="result" id="result"></div>
      <div class="controls">
        <div class="tiny" id="hintArea">íŒíŠ¸: ë²„íŠ¼ì„ ëˆŒëŸ¬ íŒíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš” ğŸ”</div>
        <div>
          <button class="btn" id="btnHint">íŒíŠ¸</button>
          <button class="btn primary" id="btnNext" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
          <button class="btn" id="btnRestart">ì²˜ìŒë¶€í„°</button>
        </div>
      </div>
    </div>

    <footer class="tiny">
      íŒ: ì •ë‹µì„ ê³ ë¥´ë©´ ì§€ë„ì— **ê°•ì¡°**ê°€ ìœ ì§€ë˜ê³ , â€œë‹¤ìŒ ë¬¸ì œâ€ë¥¼ ëˆ„ë¥´ë©´ ìƒˆ êµ­ê°€ë¡œ ì´ë™í•©ë‹ˆë‹¤. íŒíŠ¸ëŠ” ë‹¨ê³„ë³„(ëŒ€ë¥™ â†’ ìˆ˜ë„ â†’ ëŒ€í‘œìŒì‹/ëª…ì†Œ)ë¡œ ì—´ë¦½ë‹ˆë‹¤.
    </footer>
  </div>

  <!-- Leaflet & TopoJSON & Pattern -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <script src="https://unpkg.com/leaflet.pattern/leaflet.pattern.min.js"></script>

  <script>
  // ====== ì„¤ì • ======
  const TOTAL_QUESTIONS = 10;
  const CHOICES_COUNT   = 4;
  const HIGHLIGHT_COLOR = "#ff5722";
  const DEBUG_MODE = false; // trueë¡œ ë°”ê¾¸ë©´ ë§ˆì§€ë§‰ ì—ëŸ¬ë¥¼ íŒíŠ¸ì˜ì—­ì— ë„ì›€

  // ====== ìºì‹œ & ë§¤í•‘ ======
  const korCache  = new Map();   // ì˜ë¬¸êµ­ê°€ëª… -> í•œê¸€êµ­ê°€ëª…
  const infoCache = new Map();   // ì˜ë¬¸êµ­ê°€ëª… -> { capital, cca2, region }
  const nameFix = {
    "Congo (Kinshasa)": "Democratic Republic of the Congo",
    "Congo (Brazzaville)": "Republic of the Congo",
    "CÃ´te dâ€™Ivoire": "CÃ´te d'Ivoire",
    "Ivory Coast": "CÃ´te d'Ivoire",
    "Eswatini (Swaziland)": "Eswatini",
    "Syria": "Syrian Arab Republic",
    "Bolivia": "Bolivia (Plurinational State of)",
    "Tanzania": "Tanzania, United Republic of",
    "Moldova": "Moldova, Republic of",
    "Vatican": "Holy See",
    "Laos": "Lao People's Democratic Republic",
    "Palestine": "Palestine, State of",
    "Cape Verde": "Cabo Verde",
    "Micronesia": "Micronesia (Federated States of)",
    "North Korea": "Korea (Democratic People's Republic of)",
    "South Korea": "Korea (Republic of)",
    "Russia": "Russian Federation",
    "Iran": "Iran (Islamic Republic of)",
    "Vietnam": "Viet Nam",
    "TÃ¼rkiye": "Turkey" // REST CountriesëŠ” TÃ¼rkiyeë„ ì˜ ì£¼ì§€ë§Œ ë°©ì§€ìš©
  };
  const overrides = {
    "Korea (Republic of)": "ëŒ€í•œë¯¼êµ­",
    "Korea (Democratic People's Republic of)": "ë¶í•œ",
    "United States of America": "ë¯¸êµ­",
    "United States": "ë¯¸êµ­",
    "United Kingdom": "ì˜êµ­",
    "Russian Federation": "ëŸ¬ì‹œì•„",
    "China": "ì¤‘êµ­", "Japan": "ì¼ë³¸", "Germany": "ë…ì¼", "France": "í”„ë‘ìŠ¤",
    "Italy": "ì´íƒˆë¦¬ì•„", "Spain": "ìŠ¤í˜ì¸", "Portugal": "í¬ë¥´íˆ¬ê°ˆ",
    "Netherlands": "ë„¤ëœë€ë“œ", "Belgium": "ë²¨ê¸°ì—", "Switzerland": "ìŠ¤ìœ„ìŠ¤",
    "Austria": "ì˜¤ìŠ¤íŠ¸ë¦¬ì•„", "Czechia": "ì²´ì½”", "Poland": "í´ë€ë“œ",
    "Hungary": "í—ê°€ë¦¬", "Romania": "ë£¨ë§ˆë‹ˆì•„", "Bulgaria": "ë¶ˆê°€ë¦¬ì•„",
    "Greece": "ê·¸ë¦¬ìŠ¤", "Turkey": "íŠ€ë¥´í‚¤ì˜ˆ", "Ukraine": "ìš°í¬ë¼ì´ë‚˜",
    "Finland": "í•€ë€ë“œ", "Norway": "ë…¸ë¥´ì›¨ì´", "Sweden": "ìŠ¤ì›¨ë´",
    "Denmark": "ë´ë§ˆí¬", "Ireland": "ì•„ì¼ëœë“œ", "Canada": "ìºë‚˜ë‹¤",
    "Mexico": "ë©•ì‹œì½”", "Brazil": "ë¸Œë¼ì§ˆ", "Argentina": "ì•„ë¥´í—¨í‹°ë‚˜",
    "Chile": "ì¹ ë ˆ", "Peru": "í˜ë£¨", "Colombia": "ì½œë¡¬ë¹„ì•„",
    "Australia": "ì˜¤ìŠ¤íŠ¸ë ˆì¼ë¦¬ì•„", "New Zealand": "ë‰´ì§ˆëœë“œ",
    "India": "ì¸ë„", "Pakistan": "íŒŒí‚¤ìŠ¤íƒ„", "Bangladesh": "ë°©ê¸€ë¼ë°ì‹œ",
    "Indonesia": "ì¸ë„ë„¤ì‹œì•„", "Viet Nam": "ë² íŠ¸ë‚¨", "Thailand": "íƒœêµ­",
    "Philippines": "í•„ë¦¬í•€", "Malaysia": "ë§ë ˆì´ì‹œì•„", "Singapore": "ì‹±ê°€í¬ë¥´",
    "Saudi Arabia": "ì‚¬ìš°ë””ì•„ë¼ë¹„ì•„", "United Arab Emirates": "ì•„ëì—ë¯¸ë¦¬íŠ¸",
    "Iran (Islamic Republic of)": "ì´ë€", "Iraq": "ì´ë¼í¬", "Israel": "ì´ìŠ¤ë¼ì—˜",
    "Egypt": "ì´ì§‘íŠ¸", "South Africa": "ë‚¨ì•„í”„ë¦¬ì¹´ê³µí™”êµ­",
    "Morocco": "ëª¨ë¡œì½”", "Algeria": "ì•Œì œë¦¬", "Ethiopia": "ì—í‹°ì˜¤í”¼ì•„",
    "Nigeria": "ë‚˜ì´ì§€ë¦¬ì•„", "Kenya": "ì¼€ëƒ",
    "Democratic Republic of the Congo": "ì½©ê³ ë¯¼ì£¼ê³µí™”êµ­",
    "Republic of the Congo": "ì½©ê³ ê³µí™”êµ­",
    "CÃ´te d'Ivoire": "ì½”íŠ¸ë””ë¶€ì•„ë¥´",
    "Eswatini": "ì—ìŠ¤ì™€í‹°ë‹ˆ"
  };
  const continentKor = {
    "Africa": "ì•„í”„ë¦¬ì¹´", "Asia": "ì•„ì‹œì•„", "Europe": "ìœ ëŸ½",
    "Oceania": "ì˜¤ì„¸ì•„ë‹ˆì•„", "Americas": "ì•„ë©”ë¦¬ì¹´", "Antarctic": "ë‚¨ê·¹"
  };
  const foodHints = {
    "Korea (Republic of)": "ê¹€ì¹˜, ë¶ˆê³ ê¸°", "Japan": "ìŠ¤ì‹œ, ë¼ë©˜",
    "Italy": "í”¼ì, íŒŒìŠ¤íƒ€", "France": "ë°”ê²ŒíŠ¸, í¬ë£¨ì•„ìƒ",
    "United States": "í–„ë²„ê±°, í•«ë„ê·¸", "China": "ë§Œë‘, í› ê¶ˆ",
    "India": "ì»¤ë¦¬, ë¹„ë¥´ì•¼ë‹ˆ", "Mexico": "íƒ€ì½”, ë¶€ë¦¬ë˜",
    "Thailand": "ë˜ ì–Œê¿, íŒŸíƒ€ì´", "Viet Nam": "ìŒ€êµ­ìˆ˜, ë°˜ë¯¸",
    "Turkey": "ì¼€ë°¥", "Greece": "ìˆ˜ë¸”ë¼í‚¤", "Egypt": "ì½”ìƒ¤ë¦¬", "Brazil": "ìŠˆí•˜ìŠ¤ì½”"
  };
  const landmarkHints = {
    "France": "ì—í íƒ‘, ë£¨ë¸Œë¥´", "Italy": "ì½œë¡œì„¸ì›€, í”¼ì‚¬ì˜ ì‚¬íƒ‘",
    "United Kingdom": "ë¹…ë²¤, ë²„í‚¹ì—„ ê¶ì „", "United States": "ììœ ì˜ ì—¬ì‹ ìƒ, ê·¸ëœë“œìºë…„",
    "China": "ë§Œë¦¬ì¥ì„±", "Japan": "í›„ì§€ì‚°", "India": "íƒ€ì§€ë§ˆí• ",
    "Turkey": "ì•„ì•¼ì†Œí”¼ì•„", "Egypt": "í”¼ë¼ë¯¸ë“œ", "Brazil": "ë¦¬ìš° ì˜ˆìˆ˜ìƒ"
  };

  // ====== REST Countries ë„ìš°ë¯¸ ======
  async function queryCountry(nameEng) {
    const q = nameFix[nameEng] || nameEng;
    let url = `https://restcountries.com/v3.1/name/${encodeURIComponent(q)}?fullText=true&fields=name,translations,capital,region,cca2`;
    let res = await fetch(url);
    if (!res.ok) {
      url = `https://restcountries.com/v3.1/name/${encodeURIComponent(q)}?fields=name,translations,capital,region,cca2`;
      res = await fetch(url);
    }
    if (res.ok) {
      const data = await res.json();
      return Array.isArray(data) ? data[0] : null;
    } else {
      if (DEBUG_MODE) console.warn('REST 404:', url);
    }
    return null;
  }

  async function getKorName(nameEng) {
    if (korCache.has(nameEng)) return korCache.get(nameEng);
    if (overrides[nameEng]) { korCache.set(nameEng, overrides[nameEng]); return overrides[nameEng]; }
    try {
      const hit = await queryCountry(nameEng);
      const kor = hit?.translations?.kor?.common || hit?.translations?.kor?.official || hit?.name?.common || nameEng;
      korCache.set(nameEng, kor);
      return kor;
    } catch { korCache.set(nameEng, nameEng); return nameEng; }
  }

  async function getCountryInfo(nameEng) {
    if (infoCache.has(nameEng)) return infoCache.get(nameEng);
    let out = { capital: null, cca2: null, region: null };
    const hit = await queryCountry(nameEng);
    out.capital = Array.isArray(hit?.capital) ? hit.capital[0] : (hit?.capital || null);
    out.region  = hit?.region || null;
    out.cca2    = hit?.cca2 || null; // â† ISO2ì½”ë“œ
    infoCache.set(nameEng, out);
    return out;
  }

  // ====== ì „ì—­ ìƒíƒœ ======
  let map, countryLayer;
  let allFeatures = [];  // {id, nameEng, nameKor, layer}
  let remainingIds = [];
  let current = null;
  let score = 0, round = 0, streak = 0, hintLevel = 0;

  // ====== UI ======
  const scoreBadge  = document.getElementById("scoreBadge");
  const roundBadge  = document.getElementById("roundBadge");
  const streakBadge = document.getElementById("streakBadge");
  const progressBar = document.getElementById("progressBar");
  const choicesEl   = document.getElementById("choices");
  const resultEl    = document.getElementById("result");
  const hintArea    = document.getElementById("hintArea");
  const btnHint     = document.getElementById("btnHint");
  const btnNext     = document.getElementById("btnNext");
  const btnRestart  = document.getElementById("btnRestart");
  const questionEl  = document.getElementById("question");

  // ====== ìœ í‹¸ ======
  const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
  const sample  = (arr, n) => shuffle(arr.slice()).slice(0, n);
  const setDebug = (msg) => { if (DEBUG_MODE && hintArea) hintArea.textContent = "DEBUG: " + msg; };

  function updateBadges() {
    scoreBadge.textContent  = `ì ìˆ˜ ${score}`;
    roundBadge.textContent  = `ë¬¸ì œ ${round} / ${TOTAL_QUESTIONS}`;
    streakBadge.textContent = `ì—°ì†ì •ë‹µ ${streak}`;
    progressBar.style.width = `${(round / TOTAL_QUESTIONS) * 100}%`;
  }
  function setResult(text, ok) {
    resultEl.textContent = text;
    resultEl.style.color = ok ? "#0a7d2b" : "#c62828";
  }

  // ====== ì§€ë„ ======
  const defaultStyle   = { weight: 0.9, color: "#8a8a8a", fillColor: "#dfe7ef", fillOpacity: 0.82 };
  const highlightStyle = { weight: 2,   color: "#111",   fillColor: HIGHLIGHT_COLOR, fillOpacity: 0.76 };

  function initMap() {
    map = L.map("map", {
      renderer: L.svg(),     // â˜… SVG ê°•ì œ (íŒ¨í„´ ì ìš©ì„ ìœ„í•´ í•„ìˆ˜)
      zoomSnap: 0.1, worldCopyJump: false, minZoom: 1.5
    });
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO', subdomains: 'abcd', maxZoom: 19
    }).addTo(map);
    map.setView([20, 0], 2);
  }

  async function loadData() {
    const topo = await fetch("https://unpkg.com/world-atlas@2/countries-110m.json").then(r => r.json());
    const geo  = topojson.feature(topo, topo.objects.countries);

    countryLayer = L.geoJSON(geo, {
      style: defaultStyle,
      onEachFeature: (feature, layer) => {
        const id = String(feature.id ?? feature.properties?.id ?? "");
        const name = feature.properties?.name || feature.properties?.name_long || feature.properties?.admin;
        if (!name) return;
        allFeatures.push({ id, nameEng: name, nameKor: null, layer });
      }
    }).addTo(map);

    allFeatures = allFeatures.filter(r => r.nameEng && !/antarctica/i.test(r.nameEng));
    remainingIds = allFeatures.map(r => r.id);
  }

  function resetStyles() { if (countryLayer) countryLayer.setStyle(defaultStyle); }
  function clearFillPattern(rec) {
    try {
      const el = rec.layer.getElement?.();
      el?.querySelectorAll?.('path')?.forEach(p => p.removeAttribute('fill'));
    } catch {}
  }

  function fitAndHighlight(rec) {
    resetStyles();
    clearFillPattern(rec);
    rec.layer.setStyle(highlightStyle);
    try {
      const b = rec.layer.getBounds();
      map.fitBounds(b.pad(0.5), { animate: true, duration: 0.6 });
      rec.layer.bringToFront();
    } catch { map.setView([20,0],2); }
  }

  // ====== path ë Œë” ëŒ€ê¸° ======
  function waitForPaths(rec) {
    return new Promise(resolve => {
      const tick = () => {
        const el = rec.layer.getElement?.();
        const paths = el && el.querySelectorAll?.('path');
        if (paths && paths.length) resolve({ el, paths });
        else requestAnimationFrame(tick);
      };
      tick();
    });
  }

  // ====== êµ­ê¸° ì±„ìš°ê¸° (flagcdn + ISO2ì½”ë“œ) ======
  async function fillWithFlag(rec) {
    try {
      const info = await getCountryInfo(rec.nameEng);
      const code = info.cca2 ? info.cca2.toLowerCase() : null;
      if (!code) { setDebug('no cca2'); return; }

      // flagcdn URL (ê°€ë²¼ì›€, CORS OK). í•´ìƒë„ëŠ” w320ë¡œ ì¶©ë¶„.
      const flagUrl = `https://flagcdn.com/w320/${code}.png`;

      // ë¨¼ì € ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ HEADë¡œ ê°€ë³ê²Œ í™•ì¸(404 ë°©ì§€)
      const head = await fetch(flagUrl, { method: 'HEAD' });
      if (!head.ok) { setDebug('flag 404 ' + flagUrl); return; }

      // path ë Œë” ëŒ€ê¸°
      const { el: groupEl } = await waitForPaths(rec);

      const pane = map.getPane('overlayPane');
      const svg  = pane.querySelector('svg');
      if (!svg) { setDebug('no svg'); return; }

      let defs = svg.querySelector('defs');
      if (!defs) { defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs'); svg.prepend(defs); }

      const bbox  = groupEl.getBBox();
      const patId = `flagpat-${Math.random().toString(36).slice(2)}`;

      const pat = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
      pat.setAttribute('id', patId);
      pat.setAttribute('patternUnits', 'userSpaceOnUse');
      pat.setAttribute('x', bbox.x);
      pat.setAttribute('y', bbox.y);
      pat.setAttribute('width', bbox.width);
      pat.setAttribute('height', bbox.height);

      const img = document.createElementNS('http://www.w3.org/2000/svg', 'image');
      img.setAttributeNS('http://www.w3.org/1999/xlink', 'href', flagUrl);
      img.setAttribute('x', bbox.x);
      img.setAttribute('y', bbox.y);
      img.setAttribute('width', bbox.width);
      img.setAttribute('height', bbox.height);
      img.setAttribute('preserveAspectRatio', 'xMidYMid slice');

      pat.appendChild(img);
      defs.appendChild(pat);

      groupEl.querySelectorAll('path').forEach(p => {
        p.setAttribute('fill', `url(#${patId})`);
        p.setAttribute('stroke', '#111');
        p.setAttribute('stroke-width', '2');
      });
    } catch (e) { setDebug('flag error'); }
  }

  // ====== ë¼ìš´ë“œ ì§„í–‰ ======
  async function nextQuestion() {
    if (round >= TOTAL_QUESTIONS || remainingIds.length === 0) { finish(); return; }
    round++; hintLevel = 0;
    updateBadges(); resultEl.textContent = ""; btnNext.disabled = true;

    const pickId = remainingIds.splice(Math.floor(Math.random() * remainingIds.length), 1)[0];
    const rec = allFeatures.find(r => r.id === pickId);
    current = rec;

    // ë³´ê¸° êµ¬ì„±
    const others = allFeatures.filter(r => r.id !== rec.id);
    const distractors = sample(others, CHOICES_COUNT - 1);

    // í•œê¸€ ë³€í™˜
    const need = [rec, ...distractors];
    const korNames = await Promise.all(need.map(x => getKorName(x.nameEng)));
    korNames.forEach((k, i) => { need[i].nameKor = k; });
    const options = shuffle(need).map(x => ({ key: x.nameEng, label: x.nameKor || x.nameEng }));

    // ì§€ë„ ì—°ì¶œ
    fitAndHighlight(rec);
    await fillWithFlag(rec);

    questionEl.textContent = "ì´ ë‚˜ë¼ê°€ ì–´ë””ì¼ê¹Œìš”?";
    renderChoices(options, rec.nameEng);

    hintArea.textContent = "íŒíŠ¸: ëŒ€ë¥™ â†’ ìˆ˜ë„ â†’ ëŒ€í‘œìŒì‹/ëª…ì†Œ ìˆœì„œë¡œ ê³µê°œë©ë‹ˆë‹¤.";
  }

  function renderChoices(options, answerKeyEng) {
    choicesEl.innerHTML = "";
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "choice";
      btn.textContent = opt.label;
      btn.dataset.key = opt.key;
      btn.onclick = () => {
        Array.from(document.querySelectorAll("button.choice")).forEach(b => b.disabled = true);
        const correct = (btn.dataset.key === answerKeyEng);
        if (correct) { score += 10; streak += 1; setResult(`ì •ë‹µ! âœ… ${opt.label}`, true); }
        else { streak = 0; getKorName(answerKeyEng).then(k => setResult(`ì˜¤ë‹µ! âŒ ì •ë‹µì€ ${k}`, false)); }
        updateBadges(); btnNext.disabled = false;
      };
      choicesEl.appendChild(btn);
    });
  }

  function finish() {
    if (countryLayer) countryLayer.setStyle(defaultStyle);
    map.setView([20,0],2);
    questionEl.textContent = "ê²Œì„ ì¢…ë£Œ!";
    choicesEl.innerHTML = "";
    setResult(`ìµœì¢… ì ìˆ˜: ${score}ì  / ìµœëŒ€ ${TOTAL_QUESTIONS*10}ì `, true);
    btnNext.disabled = true;
  }

  function restart() {
    score = 0; round = 0; streak = 0;
    remainingIds = allFeatures.map(r => r.id);
    updateBadges(); nextQuestion();
  }

  // ====== íŒíŠ¸ (ëŒ€ë¥™â†’ìˆ˜ë„â†’ìŒì‹/ëª…ì†Œ) ======
  btnHint.onclick = async () => {
    if (!current) return;
    const info = await getCountryInfo(current.nameEng);
    const parts = [];
    if (hintLevel === 0) {
      const cont = continentKor[info.region] || info.region || "ì •ë³´ ì—†ìŒ";
      parts.push(`ëŒ€ë¥™: ${cont}`);
    } else if (hintLevel === 1) {
      const capKor = info.capital ? await getKorName(info.capital) : null;
      parts.push(`ìˆ˜ë„: ${capKor || info.capital || "ì •ë³´ ì—†ìŒ"}`);
    } else {
      const key1 = nameFix[current.nameEng] || current.nameEng;
      const foods = foodHints[key1];
      const spots = landmarkHints[key1];
      if (foods) parts.push(`ëŒ€í‘œ ìŒì‹: ${foods}`);
      if (spots) parts.push(`ìœ ëª…í•œ ê³³: ${spots}`);
      if (!foods && !spots) parts.push("ì¶”ê°€ íŒíŠ¸: êµ­ê¸° ë¬´ëŠ¬ë¥¼ ì˜ ë´ìš” ğŸ‘€");
    }
    hintArea.textContent = "íŒíŠ¸: " + parts.join(" | ");
    hintLevel = (hintLevel + 1) % 3;
  };

  // ====== ë²„íŠ¼ ======
  btnNext.onclick = nextQuestion;
  btnRestart.onclick = () => restart();

  // ====== ì‹œì‘ ======
  (async function main(){
    initMap();
    if (typeof topojson === 'undefined') {
      const s = document.createElement('script');
      s.src = 'https://unpkg.com/topojson-client@3';
      document.head.appendChild(s);
      await new Promise(r => s.onload = r);
    }
    await loadData();
    restart();
  })();
</script>
</body>
</html>
